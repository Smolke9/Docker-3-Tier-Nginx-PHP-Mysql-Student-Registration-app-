# update packages
sudo apt update && sudo apt upgrade -y

# install docker and docker-compose (if not already)
sudo apt install -y docker.io docker-compose

# enable & start docker
sudo systemctl enable --now docker

# allow your user to run docker (logout/login needed)
sudo usermod -aG docker $USER

~/student-app/
â”œâ”€â”€ www/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ register.php
â”‚   â””â”€â”€ db.php
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ default.conf
â””â”€â”€ mysql-init/
    â””â”€â”€ init.sql

âœ… STEP 1 â€“ Create Required Files
ðŸ‘‰ 1) index.html

nano ~/student-app/www/index.html

<!DOCTYPE html>
<html>
<head>
<title>Student Register</title>
</head>
<body>
<h2>Student Registration</h2>
<form action="register.php" method="POST">
    Name: <input type="text" name="fullname" required><br><br>
    Email: <input type="email" name="email" required><br><br>
    Roll No: <input type="text" name="roll" required><br><br>
    <button type="submit">Submit</button>
</form>
</body>
</html>

ðŸ‘‰ 2) db.php

nano ~/student-app/www/db.php

<?php
$mysqli = new mysqli("mysql", "studentuser", "studentpass", "studentdb");

if ($mysqli->connect_error) {
    die("DB Connection failed: " . $mysqli->connect_error);
}
?>

ðŸ‘‰ 3) register.php

nano ~/student-app/www/register.php

<?php
require "db.php";

$fullname = $_POST['fullname'];
$email = $_POST['email'];
$roll = $_POST['roll'];

$stmt = $mysqli->prepare("INSERT INTO students(fullname,email,roll) VALUES (?,?,?)");
$stmt->bind_param("sss", $fullname, $email, $roll);

if ($stmt->execute()) {
    echo "Student Registered Successfully!";
} else {
    echo "Error: " . $stmt->error;
}
?>

ðŸ‘‰ 4) MySQL init.sql

nano ~/student-app/mysql-init/init.sql

CREATE DATABASE IF NOT EXISTS studentdb;

CREATE USER IF NOT EXISTS 'studentuser'@'%' IDENTIFIED BY 'studentpass';
GRANT ALL PRIVILEGES ON studentdb.* TO 'studentuser'@'%';
FLUSH PRIVILEGES;

USE studentdb;

CREATE TABLE IF NOT EXISTS students (
  id INT AUTO_INCREMENT PRIMARY KEY,
  fullname VARCHAR(255),
  email VARCHAR(255),
  roll VARCHAR(255)
);

ðŸ‘‰ 5) nginx/default.conf

nano ~/student-app/nginx/default.conf

server {
    listen 80;
    root /var/www/html;
    index index.html index.php;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass php-fpm:9000;
        fastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;
    }
}

âœ… STEP 2 â€“ Create Docker Networks

Two networks are required:

docker network create frontend
docker network create backend


âœ… STEP 3 â€“ Run MySQL Container
docker run -d \
  --name mysql \
  --network backend \
  -e MYSQL_ROOT_PASSWORD=rootpass123 \
  -v ~/student-app/mysql-data:/var/lib/mysql \
  -v ~/student-app/mysql-init:/docker-entrypoint-initdb.d \
  mysql:8.0


âœ… STEP 4 â€” Create NEW PHP container WITH mysqli installed

Run this:

docker run -d \
  --name php-fpm \
  -v ~/student-app/www:/var/www/html \
  php:8.1-fpm bash -c "docker-php-ext-install mysqli && php-fpm"


âœ… STEP 5 â€” connect Networks
docker network connect frontend php-fpm
docker network connect backend php-fpm

âœ… STEP 6 â€“ Run Nginx Container
docker run -d \
  --name nginx \
  --network frontend \
  -p 80:80 \
  -v ~/student-app/www:/var/www/html:ro \
  -v ~/student-app/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro \
  nginx


